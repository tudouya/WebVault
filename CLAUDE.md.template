# CLAUDE.MD - {PROJECT_NAME}

> {PROJECT_DESCRIPTION}
> 版本: {PROJECT_VERSION} | 最后更新: {LAST_UPDATE_DATE}

## 1. Project High-Level Goal

{PROJECT_GOAL_STATEMENT}

- **项目类型**: Web应用, {PROJECT_CATEGORY} ({DEPLOYMENT_TYPE})
- **核心功能**:
  - **{FEATURE_MODULE_1}** ({FEATURE_MODULE_1_EN}) - {FEATURE_MODULE_1_DESCRIPTION}
  - **{FEATURE_MODULE_2}** ({FEATURE_MODULE_2_EN}) - {FEATURE_MODULE_2_DESCRIPTION}
  - **{FEATURE_MODULE_3}** ({FEATURE_MODULE_3_EN}) - {FEATURE_MODULE_3_DESCRIPTION}
  - **{FEATURE_MODULE_4}** ({FEATURE_MODULE_4_EN}) - {FEATURE_MODULE_4_DESCRIPTION}
  - **{FEATURE_MODULE_5}** ({FEATURE_MODULE_5_EN}) - {FEATURE_MODULE_5_DESCRIPTION}
  - **用户管理** (User & RBAC Management) - 用户、角色、权限动态管理
  - **仪表盘** (Dashboard) - 系统概览、数据分析、关键指标监控
  - **系统设置** (System Configuration) - 安全策略、第三方集成、操作日志
- **目标用户**:
  - {PRIMARY_USER_ROLE} / {PRIMARY_USER_DESCRIPTION}
  - {SECONDARY_USER_ROLE} / {SECONDARY_USER_DESCRIPTION}
  - {MANAGEMENT_ROLE} / {MANAGEMENT_DESCRIPTION}
- **关键指标**:
  - {KEY_METRIC_1}
  - {KEY_METRIC_2}
  - {KEY_METRIC_3}
  - 平台用户活跃度 (DAU/MAU)

## 2. Tech Stack & Versions

### 🏗️ **核心技术栈**

- **Language**: TypeScript (严格模式)
- **Framework**: Next.js (App Router)
- **Runtime**: React (客户端/服务端组件)
- **Package Manager**: npm
- **Database**: MySQL 8.0+ + Prisma ORM
- **Authentication**: NextAuth.js + bcryptjs (密码哈希)

### 🎨 **UI & 组件系统**

- **设计系统**: shadcn/ui (Radix UI + Tailwind CSS)
- **动效组件**: Magic UI (AnimatedShinyText, BorderBeam, NumberTicker, RetroGrid)
- **图标系统**: Lucide React + Radix UI Icons + Tabler Icons
- **主题系统**: next-themes (亮色/暗色模式)
- **样式方案**: Tailwind CSS + CVA (组件变体管理)
- **图表可视化**: Recharts

### 📊 **状态管理 & 数据层**

- **全局状态**: Zustand (轻量级状态管理)
- **URL状态同步**: Nuqs (Type-safe search params)
- **服务端状态**: Tanstack Query (异步数据获取和缓存)
- **表单管理**: React Hook Form + Zod (表单验证)
- **表格组件**: Tanstack Data Tables (服务端分页、搜索、过滤)

### 🎯 **核心业务库**

{DOMAIN_SPECIFIC_LIBRARIES}

- **安全与认证**:
  - bcryptjs (密码哈希)
  - 自研RBAC权限系统 (`src/lib/security/`)
  - 输入验证和XSS防护 (Zod验证)

- **数据处理与分析**:
  - ✅ 自研{CORE_ENTITY_1}分析服务 (`src/lib/services/{CORE_ENTITY_1}-analytics.ts`)
  - ✅ 自研{BUSINESS_LOGIC_CALCULATOR} (`src/lib/services/{BUSINESS_LOGIC_CALCULATOR}.ts`)
  - ✅ 自研数据提取器 (`src/lib/services/{CORE_ENTITY_1}-extractors/`)
  - ✅ 自研{DATA_PROCESSOR} ({DATA_PROCESSOR_DESCRIPTION})

- **业务领域服务** (自研):
  - ✅ {CORE_ENTITY_1}服务 (`src/lib/{CORE_ENTITY_1}-service.ts`)
  - ✅ {CORE_ENTITY_2}服务 (`src/lib/{CORE_ENTITY_2}-service.ts`)
  - ✅ {CORE_ENTITY_3}服务 (`src/lib/services/{CORE_ENTITY_3}-service.ts`)
  - ✅ 认证服务 (`src/lib/services/auth.service.ts`)
  - ✅ 角色服务 (`src/lib/services/role-service.ts`)

**状态说明**:

- ✅ **已实现** - 当前项目中正在使用
- ❌ **计划中/待实现** - 文档中规划但尚未实现的功能

### 🧪 **测试工具链**

- **测试框架**: Jest + React Testing Library
- **测试环境**: jest-environment-jsdom (浏览器环境模拟)
- **TypeScript支持**: ts-jest (TypeScript测试转换)
- **用户交互测试**: @testing-library/user-event
- **DOM断言**: @testing-library/jest-dom
- **Mock工具**: 内置Mock服务 (NextAuth、Prisma、Router等)

### 🛠️ **开发工具**

- **代码质量**:
  - ESLint (静态代码分析，Next.js配置)
  - Prettier (代码格式化，Tailwind类排序)
- **Git工作流**:
  - Husky (Git Hooks)
  - lint-staged (暂存文件检查)
- **构建工具**:
  - Next.js Built-in (SWC编译器)
  - Turbopack (开发模式性能优化)
- **用户体验**:
  - Kbar (⌘+K命令面板)
  - Sonner (Toast通知系统)

### 📦 **UI扩展库**

- **日期选择**: react-day-picker (日期选择器)
- **防抖处理**: use-debounce (性能优化Hook)
- **样式工具**:
  - clsx (条件类名拼接)
  - class-variance-authority (组件变体管理)
  - tailwind-merge (Tailwind类合并)
- **动画系统**: motion (Framer Motion分支)
- **类型支持**: TypeScript类型定义包 (@types/\*)

## 3. Project Structure

> **架构选择**: Feature First Architecture
> **架构参考**: 基于 [Kiranism/next-shadcn-dashboard-starter](https://github.com/Kiranism/next-shadcn-dashboard-starter) 的功能模块化架构设计

```
{PROJECT_NAME_LOWER}/
├── prisma/                           # 数据库模型定义
│   └── schema.prisma                 # 🔥 Prisma数据库架构
│
├── public/                           # 静态资源
│   ├── favicon.svg                   # 网站图标
│   ├── logo.svg                      # 项目Logo
│   └── {STATIC_ASSETS_DIR}/          # 🔥 {STATIC_ASSETS_DESCRIPTION}
│       ├── assets/                   # {ASSETS_DESCRIPTION}
│       ├── generated/                # {GENERATED_ASSETS_DESCRIPTION}
│       └── temp/                     # 临时文件
│
├── {TEMPLATES_DIR}/                  # 🔥 {TEMPLATES_DESCRIPTION}
│   ├── {TEMPLATE_1}.md              # {TEMPLATE_1_DESCRIPTION}
│   ├── {TEMPLATE_2}.md              # {TEMPLATE_2_DESCRIPTION}
│   └── *.md                         # 其他{TEMPLATE_TYPE}模板
│
├── scripts/                          # 数据库管理脚本
│   ├── database/                     # 数据库操作脚本
│   ├── user-management/              # 用户管理脚本
│   └── *.js/*.ts                     # 初始化和迁移脚本
│
├── src/                              # ⭐ 源代码（功能模块化架构）
│   ├── app/                          # Next.js 15 App Router
│   │   ├── api/                      # API路由层
│   │   │   ├── auth/                 # 认证API
│   │   │   ├── {CORE_ENTITY_1}/      # 🔥 {CORE_ENTITY_1}管理API
│   │   │   ├── {CORE_ENTITY_2}/      # 🔥 {CORE_ENTITY_2}管理API
│   │   │   ├── {CORE_ENTITY_3}/      # 🔥 {CORE_ENTITY_3}管理API
│   │   │   ├── {API_MODULE_1}/       # 🔥 {API_MODULE_1_DESCRIPTION}API
│   │   │   └── users/                # 用户管理API
│   │   ├── dashboard/                # Dashboard应用层
│   │   │   ├── {CORE_ENTITY_1}/      # 🔥 {CORE_ENTITY_1}管理页面
│   │   │   ├── {CORE_ENTITY_2}/      # 🔥 {CORE_ENTITY_2}管理页面
│   │   │   ├── {CORE_ENTITY_3}/      # 🔥 {CORE_ENTITY_3}管理页面
│   │   │   ├── {PAGE_MODULE_1}/      # 🔥 {PAGE_MODULE_1_DESCRIPTION}页面
│   │   │   ├── users/                # 用户管理页面
│   │   │   └── layout.tsx            # Dashboard布局
│   │   ├── globals.css               # 全局样式
│   │   ├── layout.tsx                # 根布局
│   │   └── page.tsx                  # 登录页（根路由）
│   │
│   ├── components/                   # 共享UI组件层
│   │   ├── ui/                       # shadcn/ui基础组件
│   │   ├── magicui/                  # Magic UI动效组件
│   │   ├── layout/                   # 布局组件
│   │   ├── auth/                     # 认证组件
│   │   ├── providers/                # Context提供者
│   │   └── features/                 # 功能特定组件
│   │
│   ├── features/                     # ⭐ 功能模块（按业务域组织）
│   │   ├── {CORE_ENTITY_1}/          # 🔥 {CORE_ENTITY_1}管理模块
│   │   │   ├── components/           # {CORE_ENTITY_1}相关组件
│   │   │   ├── hooks/                # {CORE_ENTITY_1}相关Hooks
│   │   │   ├── services/             # {CORE_ENTITY_1}业务逻辑服务
│   │   │   ├── stores/               # {CORE_ENTITY_1}状态管理
│   │   │   ├── types/                # {CORE_ENTITY_1}类型定义
│   │   │   ├── __tests__/            # {CORE_ENTITY_1}模块测试
│   │   │   └── index.ts              # 模块统一导出
│   │   ├── {CORE_ENTITY_2}/          # 🔥 {CORE_ENTITY_2}管理模块
│   │   ├── {CORE_ENTITY_3}/          # 🔥 {CORE_ENTITY_3}管理模块
│   │   ├── {FEATURE_MODULE_1}/       # 🔥 {FEATURE_MODULE_1}模块
│   │   ├── users/                    # 用户管理模块
│   │   └── {CLASSIFICATION_MODULE}/  # {CLASSIFICATION_DESCRIPTION}模块
│   │
│   ├── lib/                          # 核心工具库
│   │   ├── auth.ts                   # NextAuth.js配置
│   │   ├── database.ts               # 🔥 数据库服务层
│   │   ├── prisma.ts                 # Prisma客户端
│   │   ├── services/                 # 业务服务层
│   │   │   ├── auth.service.ts       # 认证服务
│   │   │   ├── permission-service.ts # 🔥 权限服务
│   │   │   └── *.service.ts          # 其他业务服务
│   │   ├── {BUSINESS_ENGINE}/        # 🔥 {BUSINESS_ENGINE_DESCRIPTION}
│   │   ├── {TEMPLATE_SYSTEM}/        # 🔥 {TEMPLATE_SYSTEM_DESCRIPTION}
│   │   ├── schemas/                  # Zod验证模式
│   │   ├── security/                 # 🔥 安全相关工具
│   │   ├── types/                    # TypeScript类型定义
│   │   └── utils/                    # 通用工具函数
│   │
│   ├── stores/                       # ⭐ 全局状态管理
│   │   ├── theme-store.ts            # 主题状态管理
│   │   ├── user-store.ts             # 用户状态管理
│   │   ├── dashboard-store.ts        # Dashboard状态
│   │   ├── url-state-hooks.ts        # URL状态同步
│   │   ├── __tests__/                # Store单元测试
│   │   └── index.ts                  # Store统一导出
│   │
│   ├── hooks/                        # 自定义React Hooks
│   ├── config/                       # 应用配置
│   ├── constants/                    # 常量定义
│   └── types/                        # 全局类型定义
│
├── tests/                            # ⭐ 测试目录（标准化结构）
│   ├── e2e/                          # 端到端测试
│   │   ├── core-workflows.test.tsx   # 核心业务流程测试
│   │   └── rbac-integration.test.ts  # 权限系统集成测试
│   ├── integration/                  # 集成测试（跨模块）
│   └── manual/                       # 手动测试清单
│
├── components.json                   # shadcn/ui配置
├── jest.config.js                    # ⭐ Jest测试配置
├── jest.setup.js                     # Jest测试初始化
├── next.config.js                    # Next.js配置
├── tailwind.config.js                # Tailwind CSS配置
├── middleware.ts                     # Next.js中间件
└── tsconfig.json                     # TypeScript配置
```

## 4. Development Philosophy & Standards

> **参考来源**: 基于 [Getting Good Results from Claude Code](https://www.dzombak.com/blog/2025/08/getting-good-results-from-claude-code/) 整合{BUSINESS_DOMAIN}工具开发需求

### 🎯 **核心开发理念**

**基础信念**:

- **渐进式改进胜过大爆炸** - 小步快跑，每次变更可编译并通过测试
- **从现有代码中学习** - 深入研究项目模式，遵循既有约定
- **实用主义胜过教条主义** - 适应项目现实，选择最适合的方案
- **清晰意图胜过聪明代码** - 代码要boring和明显，避免过度设计

**简洁性原则**:

- 单一职责：每个函数/类只负责一件事
- 避免过早抽象：先实现，再优化
- 选择boring的解决方案：避免聪明的技巧
- 如果需要解释，说明太复杂了

### 📋 **开发流程标准**

#### 1. **规划与分阶段**

复杂工作分解为3-5个阶段，明确每个阶段的交付物和成功标准。

#### 2. **实现流程**

1. **理解** - 研究代码库中的现有模式
2. **测试** - 先写测试用例 (红灯)
3. **实现** - 最小代码通过测试 (绿灯)
4. **重构** - 在测试通过的前提下清理代码
5. **提交** - 明确的提交信息关联到计划

#### 3. **遇到困难时的处理策略**

**卡住时的处理方式**:

1. **记录当前状态**:
   - 尝试了什么方法
   - 具体错误信息
   - 当前的理解和假设

2. **寻求不同视角**:
   - 搜索类似问题的解决方案
   - 询问团队成员意见
   - 查看相关文档和示例

3. **考虑简化方案**:
   - 能否拆分成更小的问题？
   - 是否过度设计了？
   - 有没有更直接的实现方式？

### 🏗️ **技术标准**

#### **架构原则**

- **组合胜过继承** - 使用依赖注入
- **接口胜过单例** - 便于测试和灵活性
- **显式胜过隐式** - 清晰的数据流和依赖关系
- **测试优先思维** - 修复失败测试优于跳过，但允许临时标记

#### **代码质量要求**

**每次提交必须**:

- ✅ 编译成功
- ✅ 通过所有现有测试
- ✅ 为新功能包含测试
- ✅ 遵循项目格式/检查规范

**提交前检查清单**:

- [ ] 运行格式化工具和检查工具
- [ ] 自我审查变更内容
- [ ] 确保提交信息解释了"为什么"

#### **错误处理标准**

- **快速失败** - 提供描述性错误信息
- **包含调试上下文** - 便于问题定位
- **适当层级处理** - 在合适的层次处理错误
- **永不静默吞异常** - 避免隐藏问题

### ⚖️ **决策框架**

当存在多个有效方法时，按以下优先级选择：

1. **🧪 可测试性** - 我能轻松测试这个吗？
2. **📖 可读性** - 6个月后有人能理解这个吗？
3. **🔄 一致性** - 这符合项目模式吗？
4. **✨ 简洁性** - 这是最简单可行的方案吗？
5. **↩️ 可逆性** - 后续修改有多困难？

### 🎯 **质量门禁**

#### **完成定义 (Definition of Done)**

- [ ] 测试编写完成并通过
- [ ] 代码遵循项目约定
- [ ] 无linter/formatter警告
- [ ] 提交信息清晰明确
- [ ] 实现符合计划
- [ ] 无TODO项（除非有issue编号）

#### **测试指导原则**

- **测试行为，不测试实现** - 关注功能而非内部细节
- **一个测试一个断言** - 便于快速定位问题
- **清晰的测试命名** - 描述具体场景
- **使用现有测试工具** - 遵循项目测试模式
- **测试必须确定性** - 每次运行结果一致

### 📂 **测试目录标准化** ⚠️

**测试目录策略** (就近原则):

```
src/features/{CORE_ENTITY_1}/__tests__/    # 功能模块测试
├── components/                            # 组件测试
├── hooks/                                # Hook测试
├── services/                             # 服务测试
└── {CORE_ENTITY_1}-integration.test.tsx  # 模块集成测试

tests/                                    # 跨模块测试
├── e2e/                                 # 端到端测试
└── integration/                         # 跨功能集成测试
```

**理由**: 单元测试放在功能模块内便于维护，跨模块测试统一管理。

**命名规范**:

- ✅ 单元测试: `*.test.ts` / `*.test.tsx`
- ✅ 集成测试: `*-integration.test.ts` / `*-integration.test.tsx`
- ✅ E2E测试: `*.test.ts` (在tests/e2e/下)

**测试优先级策略**:

1. **API端点测试** - 优先保证接口可用性
2. **核心业务逻辑测试** - {CORE_ENTITY_1}管理、{PRIMARY_FUNCTIONALITY}等关键功能
3. **关键用户路径E2E** - 登录→{WORKFLOW_STEP_1}→{WORKFLOW_STEP_2}→{WORKFLOW_STEP_3}
4. **组件单元测试** - 复杂交互组件和工具函数

### ⚠️ **重要提醒**

**避免的做法**:

- ❌ 随意绕过提交钩子 (除非紧急情况)
- ❌ 长期忽略失败测试
- ❌ 提交无法编译的代码
- ❌ 基于假设工作 - 先验证现有代码
- ❌ 在根目录创建 `__tests__/` 目录 (使用规范结构)

**推荐的做法**:

- ✅ 小步提交可工作的代码
- ✅ 及时更新相关文档
- ✅ 从现有实现中学习模式
- ✅ 卡住时寻求帮助或换思路
- ✅ 遵循项目测试目录结构

---

## 📚 扩展文档

更多详细文档请参考 **[docs/README.md](docs/README.md)** - 完整的文档导航和专业指南。
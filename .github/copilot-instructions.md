<!-- Generated by Ruler -->


<!-- Source: .ruler/AGENTS.md -->

# WebVault Agent 开发指南

## 项目概览

**WebVault** 是一个网站目录管理平台，提供网址收藏、分类管理、内容发现等功能。项目定位为"网站目录管理平台"，支持网址管理、博客内容、分类组织、搜索筛选等核心功能。

**项目信息**：
- 项目名称：WebVault
- 项目类型：网站目录管理平台
- 开发阶段：开发阶段（前端已完成）
- 部署目标：Cloudflare Pages
- 使用场景：网站收藏和管理、内容发现、博客阅读

**核心功能模块**：
1. 🔗 网址管理 - 快速添加、自动获取元数据、有效性检测、评分系统
2. 📁 分类系统 - 分类管理、智能建议、标签支持、收藏集合
3. 🔍 搜索与筛选 - 全文搜索、多维度筛选、访问统计
4. 🎨 界面定制 - 多视图切换（网格/列表视图）
5. 📝 博客系统 - 博客内容管理、分类浏览、详情页面
6. 💼 商业功能 - 广告管理、推广位、访问统计
7. 🔐 用户认证 - 单用户密码保护（计划使用 Clerk）
8. 📊 数据管理 - 后续版本实现导入导出、备份恢复

## 技术栈约定

基于 Next.js SaaS 架构，适配 Cloudflare 生态环境。

- 详细规范：`stacks/nextjs-saas-stack.md` ✅
- 语言：TypeScript 5.8+
- 框架：Next.js 15.4-canary + React 19.1
- 数据库：Cloudflare D1（SQLite 兼容）
- ORM：Drizzle ORM 0.43.1 + Drizzle Kit 0.31.1
- 样式：Tailwind CSS 4.1+ + Radix UI 1.4.2
- 部署：Cloudflare Pages（静态导出模式）
- 关键依赖：
  - Zod 4.0+ - 数据验证
  - Zustand 5.0+ - 状态管理
  - nuqs 2.4+ - URL 状态同步
  - use-debounce 10.0+ - 防抖处理
  - Lucide React 0.539+ - 图标库
  - react-hook-form 7.62+ - 表单处理
  - SWR 2.3+ - 数据获取和缓存（后续可能使用）
  - jose 6.0+ - JWT 处理（后续可能使用）
  - bcryptjs 3.0+ - 密码加密（后续可能使用）

**Cloudflare 适配要点**：
- 使用 `@cloudflare/workers-types` 类型支持
- 数据库连接配置适配 D1
- 构建输出配置为静态导出
- API 路由适配 Cloudflare Pages Functions

## 目录结构与约束

基于 Next.js App Router 标准结构，采用功能模块化组织方式。

- 详细规范：`structures/nextjs-app.md` ✅

```
src/
├── app/                    # Next.js App Router [必需]
│   ├── (auth)/            # 认证路由组（可选）
│   ├── (public)/          # 公开页面路由组（可选）
│   ├── api/              # API 路由
│   │   └── [endpoint]/   # 具体端点根据功能需求创建
│   ├── layout.tsx        # 根布局
│   ├── page.tsx         # 首页
│   └── globals.css      # 全局样式
│
├── features/              # 功能模块 [按需创建]
│   └── [feature-name]/   # 具体功能模块根据需求创建
│       ├── components/   # 功能专用组件
│       ├── hooks/        # 功能专用 Hooks（可选）
│       ├── services/     # 业务逻辑（可选）
│       ├── stores/       # 状态管理（可选）
│       ├── types/        # 类型定义（可选）
│       └── utils/        # 工具函数（可选）
│
├── components/            # 共享组件 [必需]
│   ├── ui/               # Radix UI 基础组件
│   ├── layout/           # Header, Sidebar, Navigation
│   └── shared/           # 业务共享组件
│
├── hooks/                 # 全局 Hooks [必需]
├── lib/                   # 核心库和工具 [必需]
│   ├── db.ts             # D1 数据库连接配置
│   └── utils.ts          # 工具函数
│
├── config/                # 配置文件 [必需]
└── types/                 # 全局类型定义 [必需]

根目录：
├── drizzle/              # 数据库 Schema 和迁移
├── middleware.ts         # Next.js 中间件
└── .env.local           # 环境变量
```

**结构约束**：
- features/ 模块当相关文件数量 >= 3 时创建
- 具体的功能模块划分在开发过程中根据实际需求确定
- 保持 app/ 目录简洁，业务逻辑放入 features/
- API 路由使用 Cloudflare Pages Functions 规范

**当前已实现的功能模块**：
- `websites/` - 网站管理功能模块
- `blog/` - 博客功能模块
- `browsable-pages/` - 可浏览页面功能模块
- `tags/` - 标签功能模块

**当前路由结构示例**：
- `(auth)/` - 认证相关页面
- `(public)/` - 公开访问页面（blog, search, category 等）
- `api/` - 包含 websites, favicon, health 等 API 端点

## API 与数据约定

- 响应格式规范：`specs/api-response.md` ✅
- 错误码定义：`specs/error-codes.md` ✅

**WebVault 特定 API 约定**：
- 所有 API 采用 RESTful 设计原则
- API 路由结构：`/api/[resource]` - 具体资源在开发时确定
- 数据库操作通过 Drizzle ORM 执行
- 环境变量：`DATABASE_URL`（D1 连接）、`NEXT_PUBLIC_APP_URL`

**数据模型设计**：
- 网站表：包含基础信息、评分、访问统计、广告标识等字段
- 分类系统：支持标签和收藏集合
- 博客内容：独立的内容管理系统
- 用户认证：单用户模式的简化认证

## 开发流程提示

- 开发理念与标准：`docs/development-philosophy.md` ✅
- Git 工作流：渐进式迭代，小步提交，保持每次变更可编译运行
- 测试策略：功能模块内单元测试（`features/<module>/__tests__/`），跨模块集成测试（`tests/`）
- 代码质量要求：
  - 编译成功、Lint/Format 通过
  - 新增逻辑具备相应测试
  - 遵循项目结构与命名约定
  - 代码"无聊而明显"，可读性优先

## Agent 注意事项

- 严格遵循引用的规范文档，特别是 `structures/nextjs-app.md` 的文件放置规则
- 使用 ruler apply 命令会根据 ruler.toml 配置生成各 Agent 所需的文档
- Cloudflare D1 使用 SQLite 语法，注意与 PostgreSQL 的差异
- 平台化应用场景，认证系统使用 Clerk 实现单用户密码保护
- 优先实现核心功能，避免过度设计
- 所有外部依赖需验证是否与 Cloudflare Pages 兼容
- 遵循 "向现有代码学习" 原则，参考 nextjs-saas-stack 现有模式
- 数据库 Schema 变更需通过 Drizzle Kit 管理迁移文件

## 文档位置说明
本文档及所有引用文档均位于项目的 `.ruler/` 目录下：
```
webvault/.ruler/
├── AGENTS.md (本文档)
├── PROJECT.md
├── ruler.toml
├── specs/
├── stacks/
├── structures/
└── docs/
```



<!-- Source: .ruler/docs/development-philosophy.md -->

# Development Philosophy & Standards

本文档汇总团队在不同技术栈下都适用的开发理念、工作流程与质量门槛，可作为所有 AI agent 的通用支柱文档。

## 核心理念
- 渐进式迭代：分阶段实现，保持每次改动可编译、可测试。
- 向现有代码学习：遵循项目既有模式与约定，避免自成体系。
- 实用优先：基于业务现实选用最简单可行的方案，拒绝过度设计。
- 可读性胜于技巧：代码要“无聊而明显”，可读性永远优先。
- 单一职责：函数、模块、PR 均需聚焦一件事情，降低耦合与回归风险。

## 基础流程
1. **理解上下文**：阅读相关模块、历史 PR、技术栈说明。
2. **规划分阶段**：把任务拆成 3-5 个可交付节点，明确成功标准。
3. **测试先行**：能写测试的场景优先补齐红灯。
4. **实现最小解**：用最简方案跑通当前阶段，让测试全绿。
5. **重构与整理**：在测试保护下清理代码、更新文档。
6. **提交与同步**：提交信息解释“为什么”，同步团队必要信息。

遇到阻塞时：记录现状与尝试、换角度搜索资料或求助、重新评估是否可以拆分或简化方案。

## 架构与技术原则
- 组合优于继承，显式依赖优于隐式单例。
- 抽象来自重复：不要在业务尚未稳定前提前设计框架层。
- 数据流清晰、输入输出可预测，避免隐式状态变更。
- 先让测试写出来并通过，再谈重构与性能。
- 错误处理要及时失败并附带上下文，禁止静默吞错。

## 质量门槛
每次提交前请确保：
- ✅ 编译成功、Lint/Format 通过。
- ✅ 新增/修改逻辑具备相应测试；所有既有测试保持绿灯。
- ✅ 变更范围清晰、无意外修改；提交信息说明“做了什么 & 为什么”。
- ✅ 无临时 TODO（除非已绑定 issue）。

完成定义（Definition of Done）：
- [ ] 需求或缺陷得到覆盖性测试验证。
- [ ] 代码遵循项目结构与命名约定。
- [ ] 文档或注释（如有必要）已更新。
- [ ] 无阻塞的审查意见或高优先级缺陷。

## 决策框架
在多个方案之间权衡时，按以下顺序考虑：
1. **可测试性**：是否容易编写稳定的自动化测试？
2. **可读性**：半年后团队成员能否快速理解？
3. **一致性**：是否符合当前项目的模式与约定？
4. **简洁性**：能否用更少的概念完成任务？
5. **可逆性**：未来如果需求变化，回滚或修改的成本如何？

## 测试策略
- 测试行为，不测实现细节；命名清晰描述场景与预期。
- 单元测试就近放在模块内部，跨模块测试集中在 `tests/`。
- 一个测试用例尽量聚焦一个断言场景，方便定位问题。
- 使用项目既有的测试工具栈与辅助方法，保持风格统一。
- 测试必须具备确定性；如依赖外部服务，使用 mock 或 fake。

推荐目录策略：
```
src/features/<module>/__tests__/  # 模块内单元/集成测试
└── *.test.ts(x)

tests/
├── integration/                   # 跨模块集成测试
└── e2e/                            # 端到端流程
```

## 应当遵循 / 避免
**应当**
- 小步提交、及时同步上下文。
- 代码与文档同步维护，历史设计需有记录。
- 卡住时主动寻求帮助或换角度验证猜想。
- 在 PR 中解释设计取舍，便于审查者理解。

**避免**
- 绕过检查或忽视失败测试。
- 以“临时”之名提交不可运行代码。
- 在根目录堆放无组织的测试或脚本。
- 脱离项目既有模式随意创造新架构。

---

后续如有新的团队约定或重要经验，请继续在此文档补充或修订，并通知相关 Agent 配置引用最新内容。



<!-- Source: .ruler/PROJECT.md -->

# WebVault

个人网址导航管理工具，提供网址收藏、分类管理、搜索筛选等功能，专注于个人使用场景的"网址保险库"。

## 项目信息
- 项目名称：WebVault
- 项目类型：个人网址管理工具
- 开发阶段：规划阶段
- 部署目标：Cloudflare Pages

## 核心功能
1. 网址管理 - 快速添加网址、自动获取元数据、有效性检测
2. 分类系统 - 多级分类、智能建议、标签支持
3. 搜索与筛选 - 全文搜索、多维度筛选、访问统计
4. 界面定制 - 多视图切换、主题支持、布局调节
5. 数据管理 - 导入导出、备份恢复、数据迁移

## 技术选型
- 语言：TypeScript 5.8+
- 框架：Next.js 15.4-canary + React 19.1
- 数据库：Cloudflare D1（SQLite 兼容）
- 部署：Cloudflare Pages

详细技术栈规范参见：`stacks/nextjs-saas-stack.md`



<!-- Source: .ruler/specs/api-response.md -->

# API Response Specification — REST v1.0
> 适用范围：REST 接口（默认）  
> 版本策略：按接口范式拆分；REST 规范为 v1.0。GraphQL 或 RPC 规范可另行追加。

## 元信息
| 项目 | 内容 |
| ---- | ---- |
| 规范版本 | REST v1.0 |
| 适用接口 | RESTful HTTP API |
| 适用环境 | 对外 / 对内均可；如仅面向内部，可在“可裁剪项”中进行调整 |
| 可扩展位 | GraphQL、内部管理接口、移动端特定约束等 |

---

## 通用字段（REST）
- `requestId`：字符串。一次请求的唯一标识，建议透传 `X-Request-Id`，并在响应头回写。
- `timestamp`：字符串。`YYYY-MM-DD HH:MM:SS`，时区统一 `Asia/Shanghai`。
- `code`：成功固定为 `0`；错误为稳定业务错误码（蛇形命名，如 `validation_failed`）。
- `message`：面向终端用户的简短文案（中文优先）。

> **内部接口** 如倾向直接使用 HTTP 状态码，可参考“可裁剪项”进行覆盖或删减。

## 成功响应（REST）
### 非分页
```
HTTP/1.1 200 OK
Content-Type: application/json
X-Request-Id: <uuid>

{
  "code": 0,
  "message": "ok",
  "data": { /* 任意对象 */ },
  "requestId": "<uuid>",
  "timestamp": "2025-09-17 12:34:56"
}
```

### 分页
```
HTTP/1.1 200 OK
{
  "code": 0,
  "message": "ok",
  "data": [ /* 项列表 */ ],
  "meta": {
    "page": 1,
    "per_page": 20,
    "total": 135,
    "has_more": true
  },
  "links": {
    "next": "/api/resources?page=2&per_page=20",
    "prev": null
  },
  "requestId": "<uuid>",
  "timestamp": "2025-09-17 12:34:56"
}
```

## 状态码语义
- 200 OK：读取或计算成功。
- 201 Created：创建成功，返回资源 `data` 或至少 `id`。
- 204 No Content：删除或无需返回体的成功操作。

## 错误响应（REST）
```
HTTP/1.1 422 Unprocessable Entity
Content-Type: application/json
X-Request-Id: <uuid>

{
  "status": 422,
  "code": "validation_failed",
  "message": "参数校验失败",
  "errors": {
    "phone": ["手机号格式不合法"],
    "amount": ["金额必须为正数"]
  },
  "requestId": "<uuid>",
  "timestamp": "2025-09-17 12:34:56"
}
```

### 推荐状态码映射
- 400 Bad Request：通用参数错误。
- 401 Unauthorized：未认证或 Token 失效。
- 403 Forbidden：无访问权限。
- 404 Not Found：资源不存在。
- 409 Conflict：并发或状态冲突。
- 422 Unprocessable Entity：字段校验失败。
- 429 Too Many Requests：限流触发。
- 500 Internal Server Error：服务器内部错误。
- 503 Service Unavailable / 504 Gateway Timeout：下游不可用或超时。

---

## GraphQL / RPC / 内部接口扩展（可选）
> 默认 REST steering 不包含此部分。如项目需要 GraphQL、RPC 或特定内部约定，可在生成 steering 时引入对应扩展。

- **GraphQL**：建议遵循 GraphQL `errors` 数组和 `extensions` 字段；可将 `requestId` 放入 `extensions`。
- **RPC / gRPC**：采用状态码 + 详细错误对象；可参考 gRPC status 规范。
- **内部接口**：若无需 `code`、`links` 等包装，可在 steering 生成时剔除或改为日志友好的结构。

---

## 可裁剪项（按标签选择）
| 场景标签 | 可裁剪内容 | 默认操作 |
| -------- | ---------- | -------- |
| `internal_only` | `links`、`meta.has_more`、对终端用户的友好文案 | 可删除或改为内部术语 |
| `mobile_app` | `links` 改为 `next_page_token` 或 `cursor` | 若使用分页 token，可替换 |
| `graphQL` | 全部 REST 包装字段 | 替换为 GraphQL 扩展方案 |
| `minimal` | `requestId` 保留，`timestamp` 可省略 | 视服务端能力选择 |

> steering 生成器可根据项目标签自动裁剪上述内容。

---

## 版本与变更
- `REST v1.0`（当前） — 基础 REST 接口规范。
- 计划中的增量：`REST v1.1`（补充批量操作响应）、`GraphQL v1.0`、`RPC v1.0` 等。

---

*此规范可与《Standard Error Codes — REST v1.0》搭配使用。*



<!-- Source: .ruler/specs/error-codes.md -->

# Standard Error Codes — REST v1.0
> 适用范围：REST 接口默认错误码  
> 版本策略：按接口范式拆分；GraphQL / 内部接口可扩展独立清单。

## 元信息
| 项目 | 内容 |
| ---- | ---- |
| 规范版本 | REST v1.0 |
| 适用接口 | RESTful HTTP API |
| 依赖规范 | 《API Response Specification — REST v1.0》 |
| 可扩展位 | GraphQL、内部接口专用错误码 |

---

## 命名约定（REST）
- 使用小写蛇形命名（例：`validation_failed`）。
- 表达问题类别而非实现细节；跨接口复用。
- 面向对内对外场景：若内部接口倾向直接使用 HTTP 状态码，可参考“可裁剪项”。

## 通用错误码（REST）
- `bad_request`（400）：请求格式或语义错误。
- `unauthorized`（401）：未认证或凭证失效。
- `forbidden`（403）：权限不足。
- `not_found`（404）：资源不存在。
- `method_not_allowed`（405）：方法不被允许。
- `conflict`（409）：资源冲突。
- `operation_conflict`（409）：操作冲突或状态机条件不满足。
- `gone`（410）：端点或资源已废弃。
- `precondition_failed`（412）：前置条件失败。
- `payload_too_large`（413）：请求体过大。
- `unsupported_media_type`（415）：媒体类型不支持。
- `validation_failed`（422）：字段校验失败。
- `rate_limited`（429）：达到速率限制。
- `internal_error`（500）：服务器内部错误。
- `service_unavailable`（503）：依赖服务不可用。
- `gateway_timeout`（504）：网关或下游超时。

## 鉴权与账户类
- `login_failed`（401）：登录失败。
- `token_invalid`（401）：令牌无效。
- `token_expired`（401）：令牌过期。
- `mfa_required`（401/403）：需要二次验证。

## 资源与约束类
- `duplicate_resource`（409）：唯一性冲突。
- `invalid_state`（409/422）：资源状态不满足操作条件。
- `dependency_failed`（424/409）：依赖资源失败或不可用。
- `quota_exceeded`（429/403）：配额不足。

## 上传与文件类
- `file_type_not_allowed`（415）：文件类型不允许。
- `file_too_large`（413）：文件过大。
- `file_integrity_error`（422）：文件校验失败。

## 风控与安全类
- `suspicious_activity`（403）：可疑行为拦截。
- `verification_required`（403）：需要额外校验。

---

## 场景标签与裁剪建议
| 场景标签 | 应用方式 | 默认操作 |
| -------- | -------- | -------- |
| `rest_public` | 对外接口，保持稳定错误码和友好提示 | 保留整体清单 |
| `rest_internal` | 内部接口，可将 `message` 改为技术术语 | 保留 `code`，调整 `message` |
| `async_job` | 异步任务接口，建议补充 `job_timeout` 等扩展码 | 在“扩展登记”中追加 |
| `minimal` | 仅依赖 HTTP 状态码，无自定义 `code` | 可跳过此清单 |

> steering 生成器可根据场景标签挑选或裁剪错误码。

---

## 可扩展与登记模板
- 允许定义业务域扩展错误码，但需遵循命名规范并登记。

登记格式：
```
- 错误码：<snake_case_code>
- HTTP 状态码：<number>
- 场景说明：<问题描述与触发条件>
- 首次使用接口：<方法 + 路径>
- 负责人/团队：<姓名或团队>
- 上线日期：<YYYY-MM-DD>
- 兼容/废弃计划：<暂无/预计下线时间>
- 关联文档：<链接，可选>
```

示例：
```
- 错误码：duplicate_payment
- HTTP 状态码：409
- 场景说明：重复提交相同订单
- 首次使用接口：POST /api/orders/{id}/pay
- 负责人/团队：支付服务组 @zhangsan
- 上线日期：2024-05-10
- 兼容/废弃计划：暂无
- 关联文档：支付风控设计 v2
```

---

## 版本与变更
- `REST v1.0`（当前）— 适用于 REST 接口错误码。
- 计划版本：`REST v1.1`（补充批量操作错误码）、`GraphQL v1.0`、`Internal v1.0` 等。

---

*请与《API Response Specification — REST v1.0》配套使用。*



<!-- Source: .ruler/stacks/nextjs-saas-stack.md -->

# Next.js SaaS 技术栈

> 基于 [nextjs/saas-starter](https://github.com/nextjs/saas-starter) 项目
>
> 这是一个精简的全栈 SaaS 技术栈，适用于构建需要认证、支付和数据库的 SaaS 应用。

## 适用场景

- 🚀 SaaS 产品开发
- 💳 需要订阅支付功能
- 🔐 需要用户认证系统
- 💾 需要数据持久化
- 🏢 小型团队项目
- ⚡ MVP 快速验证

## 技术栈清单

### 核心框架

| 技术 | 版本 | 用途 |
|------|------|------|
| **Next.js** | 15.4.0-canary.47 | 全栈 React 框架 |
| **React** | 19.1.0 | UI 框架 |
| **React DOM** | 19.1.0 | React DOM 渲染 |
| **TypeScript** | 5.8.3 | 类型安全 |

### 数据库 & ORM

| 技术 | 版本 | 用途 |
|------|------|------|
| **PostgreSQL** | 通过 postgres 3.4.5 | 关系型数据库 |
| **Drizzle ORM** | 0.43.1 | 轻量级 TypeScript ORM |
| **Drizzle Kit** | 0.31.1 | 数据库迁移工具 |

### 样式 & UI

| 技术 | 版本 | 用途 |
|------|------|------|
| **Tailwind CSS** | 4.1.7 | 原子化 CSS 框架 |
| **@tailwindcss/postcss** | 4.1.7 | PostCSS 处理 |
| **tw-animate-css** | 1.3.0 | Tailwind 动画扩展 |
| **Radix UI** | 1.4.2 | 无样式 UI 组件库 |
| **Lucide React** | 0.511.0 | 图标库 |
| **tailwind-merge** | 3.3.0 | 合并 Tailwind 类名 |
| **clsx** | 2.1.1 | 条件类名工具 |
| **class-variance-authority** | 0.7.1 | 组件变体管理 |

### 认证 & 安全

| 技术 | 版本 | 用途 |
|------|------|------|
| **bcryptjs** | 3.0.2 | 密码哈希加密 |
| **jose** | 6.0.11 | JWT 生成和验证 |
| **server-only** | 0.0.1 | 服务端代码保护 |

### 支付集成

| 技术 | 版本 | 用途 |
|------|------|------|
| **Stripe** | 18.1.0 | 支付处理 |

### 数据获取

| 技术 | 版本 | 用途 |
|------|------|------|
| **SWR** | 2.3.3 | 数据获取和缓存 |

### 数据验证

| 技术 | 版本 | 用途 |
|------|------|------|
| **Zod** | 3.24.4 | 运行时类型验证 |

### 构建工具

| 技术 | 版本 | 用途 |
|------|------|------|
| **Turbopack** | 内置 | 快速打包工具 |
| **PostCSS** | 8.5.3 | CSS 处理 |
| **Autoprefixer** | 10.4.21 | CSS 前缀自动添加 |

### 环境配置

| 技术 | 版本 | 用途 |
|------|------|------|
| **dotenv** | 16.5.0 | 环境变量管理 |

## 项目脚本

```json
{
  "scripts": {
    "dev": "next dev --turbopack",      // 开发服务器（使用 Turbopack）
    "build": "next build",               // 生产构建
    "start": "next start",               // 生产服务器
    "db:setup": "npx tsx lib/db/setup.ts",     // 数据库设置
    "db:seed": "npx tsx lib/db/seed.ts",       // 数据库填充
    "db:generate": "drizzle-kit generate",     // 生成迁移
    "db:migrate": "drizzle-kit migrate",       // 运行迁移
    "db:studio": "drizzle-kit studio"          // 数据库可视化工具
  }
}
```

## 技术栈特点

### 优势
- ✅ **最小化依赖**：只包含必要的依赖，减少复杂度
- ✅ **现代技术栈**：使用最新版本的 Next.js 和 React
- ✅ **类型安全**：TypeScript + Drizzle ORM 提供端到端类型安全
- ✅ **性能优秀**：Turbopack + PostgreSQL + Drizzle 性能组合
- ✅ **自主可控**：自建认证系统，不依赖第三方服务
- ✅ **成本可控**：除 Stripe 外无其他付费服务

### 限制
- ⚠️ **认证功能基础**：只支持邮箱密码登录，无 OAuth、2FA
- ⚠️ **无状态管理库**：复杂状态管理需要额外添加
- ⚠️ **开发工具简单**：无 ESLint、Prettier、Husky 等配置
- ⚠️ **无错误监控**：生产环境需要额外配置
- ⚠️ **UI 组件有限**：需要自行构建或添加组件

## 适配建议

### 可选增强

如果需要增强某些功能，可以考虑添加：

| 需求 | 推荐方案 |
|------|---------|
| **状态管理** | Zustand (轻量) 或 Redux Toolkit (复杂) |
| **错误监控** | Sentry 或 LogRocket |
| **代码规范** | ESLint + Prettier + Husky |
| **测试框架** | Vitest + Testing Library |
| **更多 UI 组件** | shadcn/ui 或 Ant Design |
| **OAuth 认证** | NextAuth.js 或升级到 Clerk |
| **邮件服务** | Resend 或 SendGrid |

### 不建议修改

以下核心技术栈不建议替换：
- Next.js → 其他框架（会失去全栈能力）
- Drizzle → Prisma（除非团队更熟悉 Prisma）
- PostgreSQL → MySQL（PostgreSQL 功能更强大）
- Tailwind CSS → 其他 CSS 方案（生态最好）

## 开发流程

### 初始化项目

```bash
# 1. 克隆项目
git clone https://github.com/nextjs/saas-starter
cd saas-starter

# 2. 安装依赖
pnpm install

# 3. 配置环境变量
cp .env.example .env.local

# 4. 设置数据库
pnpm db:setup
pnpm db:migrate
pnpm db:seed

# 5. 启动开发服务器
pnpm dev
```

### 部署建议

- **托管平台**：Vercel（最佳）或 Railway
- **数据库**：Vercel Postgres 或 Supabase
- **环境变量**：通过平台管理，不要提交 .env 文件


## Steering 输出插槽
| 插槽 | 建议填充值 | 说明 |
| ---- | ---------- | ---- |
| `stack_id` | `nextjs-saas` | 供 steering 生成器识别当前技术栈 |
| `core_dependencies` | `Next.js 15.4-canary`, `React 19.1`, `TypeScript 5.8+`, `PostgreSQL`, `Drizzle ORM`, `Drizzle Kit`, `Tailwind CSS 4.1+`, `Zod`, `Stripe`, `SWR`, `jose`, `bcryptjs`, `dotenv` | Steering 文档中的依赖摘要 |
| `dev_commands` | `pnpm dev --turbopack` | 默认开发启动命令 |
| `build_commands` | `pnpm build`, `pnpm start` | 构建与生产启动 |
| `test_commands` | （按需补充，默认留空） | 如项目有测试命令可覆盖 |
| `db_commands` | `pnpm db:setup`, `pnpm db:migrate`, `pnpm db:seed`, `pnpm db:generate`, `pnpm db:studio` | 数据库脚本合集 |
| `env_required` | `DATABASE_URL`, `STRIPE_SECRET_KEY`, `STRIPE_WEBHOOK_SECRET`, `NEXT_PUBLIC_APP_URL` | 核心环境变量清单 |
| `development_philosophy` | `docs/development-philosophy.md` | 统一的开发理念与质量标准 |
| `agent_notes` | 邮箱 + 密码认证（自建），使用 Drizzle 管理 PostgreSQL；生产部署需配置 Stripe Webhook；默认包管理器为 `pnpm` | 对 AI Agent 的额外提醒 |

## 参考资源

- [Next.js SaaS Starter 源码](https://github.com/nextjs/saas-starter)
- [Next.js 文档](https://nextjs.org/docs)
- [Drizzle ORM 文档](https://orm.drizzle.team/)
- [Stripe 文档](https://stripe.com/docs)
- [Tailwind CSS 文档](https://tailwindcss.com/docs)

---

*此技术栈基于 nextjs/saas-starter 项目，适用于构建精简高效的 SaaS 应用*



<!-- Source: .ruler/structures/nextjs-app.md -->

# Next.js 项目结构规范

> 基于 [next-shadcn-dashboard-starter](https://github.com/Kiranism/next-shadcn-dashboard-starter) 最佳实践
> 参考项目：
> - [next-shadcn-dashboard-starter](https://github.com/Kiranism/next-shadcn-dashboard-starter) - 完整的 Next.js + shadcn/ui 仪表板模板
> - [nextjs/saas-starter](https://github.com/nextjs/saas-starter) - Next.js 官方 SaaS 模板
>
> 适用版本：Next.js 14+ (App Router)

## 标准目录结构

```
src/
├── app/                    # Next.js App Router [必需]
│   ├── (auth)/            # 认证路由组
│   │   ├── login/
│   │   ├── register/
│   │   └── layout.tsx
│   ├── dashboard/         # 应用主体页面
│   │   ├── page.tsx
│   │   ├── layout.tsx
│   │   └── [...子页面]/
│   ├── api/               # API 路由
│   │   └── [...endpoint]/
│   ├── layout.tsx         # 根布局
│   ├── page.tsx          # 首页
│   ├── globals.css       # 全局样式
│   ├── not-found.tsx     # 404 页面
│   └── error.tsx         # 错误处理
│
├── features/              # 功能模块 [按需]
│   ├── auth/             # 认证功能
│   │   ├── components/   # 功能组件
│   │   │   ├── LoginForm.tsx
│   │   │   └── RegisterForm.tsx
│   │   ├── hooks/        # 功能 Hooks
│   │   │   └── useAuth.ts
│   │   ├── services/     # 业务逻辑
│   │   │   └── auth.service.ts
│   │   ├── types/        # 类型定义
│   │   │   └── auth.types.ts
│   │   └── utils/        # 工具函数
│   │       └── validation.ts
│   └── [feature-name]/   # 其他功能模块
│       ├── components/
│       ├── hooks/
│       ├── services/
│       ├── types/
│       └── utils/
│
├── components/            # 共享组件 [必需]
│   ├── ui/               # 基础 UI 组件 (shadcn/ui)
│   │   ├── button.tsx
│   │   ├── card.tsx
│   │   ├── dialog.tsx
│   │   ├── input.tsx
│   │   └── [...更多]/
│   ├── forms/            # 表单组件
│   │   ├── FormField.tsx
│   │   └── FormWrapper.tsx
│   ├── layout/           # 布局组件
│   │   ├── Header.tsx
│   │   ├── Footer.tsx
│   │   ├── Sidebar.tsx
│   │   └── Navigation.tsx
│   └── shared/           # 业务共享组件
│       ├── DataTable.tsx
│       ├── SearchBar.tsx
│       └── UserAvatar.tsx
│
├── hooks/                 # 全局 Hooks [必需]
│   ├── useDebounce.ts
│   ├── useLocalStorage.ts
│   ├── useMediaQuery.ts
│   └── useFetch.ts
│
├── lib/                   # 核心库和工具 [必需]
│   ├── api-client.ts     # API 客户端
│   ├── auth.ts           # 认证配置
│   ├── db.ts             # 数据库连接
│   ├── utils.ts          # 工具函数
│   └── cn.ts             # className 工具
│
├── config/                # 配置文件 [必需]
│   ├── site.ts           # 网站配置
│   ├── navigation.ts     # 导航配置
│   └── constants.ts      # 常量配置
│
├── types/                 # 全局类型定义 [必需]
│   ├── index.ts          # 通用类型
│   ├── api.types.ts      # API 类型
│   └── database.types.ts # 数据库类型
│
└── styles/                # 样式文件 [可选]
    ├── globals.css        # 全局样式
    └── themes/            # 主题样式

根目录文件：
├── middleware.ts          # Next.js 中间件
├── instrumentation.ts     # 监控配置
└── .env.local            # 环境变量
```

## AI 文件放置规则

### 1. 页面文件
```yaml
规则: "所有页面组件"
文件: page.tsx, layout.tsx, error.tsx, loading.tsx, not-found.tsx
位置: app/[对应路径]/
示例:
  - 登录页面 → app/(auth)/login/page.tsx
  - 仪表板 → app/dashboard/page.tsx
```

### 2. API 路由
```yaml
规则: "所有 API 端点"
文件: route.ts, route.js
位置: app/api/[端点路径]/
示例:
  - 用户 API → app/api/users/route.ts
  - 认证 API → app/api/auth/[...]/route.ts
```

### 3. 功能模块
```yaml
规则: "相关功能组件群 (3+ 个相关文件)"
判断: 文件名包含相同业务词汇
位置: features/[功能名]/
示例:
  - LoginForm, LoginService → features/auth/
  - ProductList, ProductDetail → features/product/
  - CheckoutForm, PaymentService → features/checkout/
```

### 4. UI 组件
```yaml
规则: "可复用的展示组件"
判断: 无业务逻辑，纯展示
位置: components/ui/
示例:
  - Button, Card, Modal → components/ui/
  - 基于 shadcn/ui 的组件 → components/ui/
```

### 5. 共享组件
```yaml
规则: "包含业务逻辑的共享组件"
判断: 被多个功能使用
位置: components/shared/
示例:
  - UserAvatar → components/shared/
  - DataTable → components/shared/
```

### 6. 工具和配置
```yaml
规则: "工具函数和配置"
判断:
  - 工具函数 → lib/
  - React Hooks → hooks/
  - 类型定义 → types/
  - 配置文件 → config/
示例:
  - formatDate() → lib/utils.ts
  - useAuth() → hooks/useAuth.ts
  - User type → types/user.types.ts
```

## 何时创建 Feature 模块

### 创建 feature 的条件
✅ **应该创建**：
- 有 3+ 个相关组件
- 包含特定的业务逻辑
- 组件之间有依赖关系
- 可独立开发和测试

❌ **不需要创建**：
- 简单的 CRUD 页面
- 单个组件
- 纯工具函数

### Feature 内部结构
```
features/[name]/
├── components/    # 功能专用组件
├── hooks/        # 功能专用 Hooks (可选)
├── services/     # 业务逻辑 (可选)
├── types/        # 类型定义 (可选)
├── utils/        # 工具函数 (可选)
└── index.ts      # 导出入口 (可选)
```

## 命名规范

### 文件命名
| 类型 | 规范 | 示例 |
|------|------|------|
| 组件 | PascalCase | `UserProfile.tsx` |
| 工具 | camelCase | `formatDate.ts` |
| Hook | camelCase + use前缀 | `useAuth.ts` |
| 服务 | camelCase + .service | `auth.service.ts` |
| 类型 | camelCase + .types | `user.types.ts` |
| 样式 | kebab-case + .module | `user-profile.module.css` |

### 目录命名
| 类型 | 规范 | 示例 |
|------|------|------|
| 功能模块 | kebab-case | `user-management` |
| 路由组 | 括号+kebab-case | `(marketing)` |
| 动态路由 | 方括号 | `[id]`, `[...slug]` |
| 普通目录 | kebab-case | `components` |

## 导入路径配置

```json
// tsconfig.json
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./src/*"],
      "@/components/*": ["./src/components/*"],
      "@/features/*": ["./src/features/*"],
      "@/hooks/*": ["./src/hooks/*"],
      "@/lib/*": ["./src/lib/*"],
      "@/types/*": ["./src/types/*"]
    }
  }
}
```

## 最佳实践

### 1. 保持 app/ 目录简洁
- 只放页面相关文件
- 业务逻辑移到 features/ 或 lib/

### 2. Feature 模块独立性
- 每个 feature 应该能独立工作
- 避免 feature 之间相互依赖
- 共享代码放到 components/shared/

### 3. 组件分类清晰
- `ui/` - 纯 UI，无业务逻辑
- `forms/` - 表单相关
- `layout/` - 布局相关
- `shared/` - 业务共享组件

### 4. 渐进式采用 Features
- 项目初期可以不用 features/
- 当某个功能文件 >= 3 个时再创建
- 保持灵活，不要过度设计

## 示例：添加新功能

### 场景：添加购物车功能

```bash
# 1. 创建 feature 模块
features/cart/
├── components/
│   ├── CartItem.tsx
│   ├── CartSummary.tsx
│   └── CartDrawer.tsx
├── hooks/
│   └── useCart.ts
├── services/
│   └── cart.service.ts
└── types/
    └── cart.types.ts

# 2. 创建页面
app/cart/
├── page.tsx          # 导入 features/cart 组件
└── checkout/
    └── page.tsx

# 3. 添加 API
app/api/cart/
└── route.ts
```

## 迁移指南

### 从其他结构迁移到此结构

1. **第一步**：创建基础目录
   ```bash
   mkdir -p src/{app,components,hooks,lib,types,config}
   ```

2. **第二步**：移动文件
   - pages/* → app/*
   - components/* → 按类型分到 components/ui, components/shared
   - utils/* → lib/*
   - 相关功能组 → features/

3. **第三步**：更新导入路径

4. **第四步**：逐步重构
   - 不要一次性迁移所有文件
   - 按功能模块逐步迁移
   - 保持应用可运行状态

## 参考资源

### GitHub 项目
- [next-shadcn-dashboard-starter](https://github.com/Kiranism/next-shadcn-dashboard-starter) - 主要参考
- [nextjs/saas-starter](https://github.com/nextjs/saas-starter) - 官方模板参考

### 文档
- [Next.js 官方文档 - 项目结构](https://nextjs.org/docs/app/building-your-application/routing/project-organization)
- [shadcn/ui 文档](https://ui.shadcn.com/)

---

*此规范基于 Next.js 14+ App Router 和 shadcn/ui 最佳实践*

# Development Philosophy & Standards

本文档汇总团队在不同技术栈下都适用的开发理念、工作流程与质量门槛，可作为所有 AI agent 的通用支柱文档。

## 核心理念
- 渐进式迭代：分阶段实现，保持每次改动可编译、可测试。
- 向现有代码学习：遵循项目既有模式与约定，避免自成体系。
- 实用优先：基于业务现实选用最简单可行的方案，拒绝过度设计。
- 可读性胜于技巧：代码要“无聊而明显”，可读性永远优先。
- 单一职责：函数、模块、PR 均需聚焦一件事情，降低耦合与回归风险。

## 基础流程
1. **理解上下文**：阅读相关模块、历史 PR、技术栈说明。
2. **规划分阶段**：把任务拆成 3-5 个可交付节点，明确成功标准。
3. **测试先行**：能写测试的场景优先补齐红灯。
4. **实现最小解**：用最简方案跑通当前阶段，让测试全绿。
5. **重构与整理**：在测试保护下清理代码、更新文档。
6. **提交与同步**：提交信息解释“为什么”，同步团队必要信息。

遇到阻塞时：记录现状与尝试、换角度搜索资料或求助、重新评估是否可以拆分或简化方案。

## 架构与技术原则
- 组合优于继承，显式依赖优于隐式单例。
- 抽象来自重复：不要在业务尚未稳定前提前设计框架层。
- 数据流清晰、输入输出可预测，避免隐式状态变更。
- 先让测试写出来并通过，再谈重构与性能。
- 错误处理要及时失败并附带上下文，禁止静默吞错。

## 质量门槛
每次提交前请确保：
- ✅ 编译成功、Lint/Format 通过。
- ✅ 新增/修改逻辑具备相应测试；所有既有测试保持绿灯。
- ✅ 变更范围清晰、无意外修改；提交信息说明“做了什么 & 为什么”。
- ✅ 无临时 TODO（除非已绑定 issue）。

完成定义（Definition of Done）：
- [ ] 需求或缺陷得到覆盖性测试验证。
- [ ] 代码遵循项目结构与命名约定。
- [ ] 文档或注释（如有必要）已更新。
- [ ] 无阻塞的审查意见或高优先级缺陷。

## 决策框架
在多个方案之间权衡时，按以下顺序考虑：
1. **可测试性**：是否容易编写稳定的自动化测试？
2. **可读性**：半年后团队成员能否快速理解？
3. **一致性**：是否符合当前项目的模式与约定？
4. **简洁性**：能否用更少的概念完成任务？
5. **可逆性**：未来如果需求变化，回滚或修改的成本如何？

## 测试策略
- 测试行为，不测实现细节；命名清晰描述场景与预期。
- 单元测试就近放在模块内部，跨模块测试集中在 `tests/`。
- 一个测试用例尽量聚焦一个断言场景，方便定位问题。
- 使用项目既有的测试工具栈与辅助方法，保持风格统一。
- 测试必须具备确定性；如依赖外部服务，使用 mock 或 fake。

推荐目录策略：
```
src/features/<module>/__tests__/  # 模块内单元/集成测试
└── *.test.ts(x)

tests/
├── integration/                   # 跨模块集成测试
└── e2e/                            # 端到端流程
```

## 应当遵循 / 避免
**应当**
- 小步提交、及时同步上下文。
- 代码与文档同步维护，历史设计需有记录。
- 卡住时主动寻求帮助或换角度验证猜想。
- 在 PR 中解释设计取舍，便于审查者理解。

**避免**
- 绕过检查或忽视失败测试。
- 以“临时”之名提交不可运行代码。
- 在根目录堆放无组织的测试或脚本。
- 脱离项目既有模式随意创造新架构。

---

后续如有新的团队约定或重要经验，请继续在此文档补充或修订，并通知相关 Agent 配置引用最新内容。
